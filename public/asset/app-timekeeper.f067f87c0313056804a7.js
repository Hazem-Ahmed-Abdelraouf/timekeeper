(()=>{"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function e(e,n){return function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i=[],o=!0,u=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){u=!0,a=t}finally{try{o||null==n.return||n.return()}finally{if(u)throw a}}return i}}(e,n)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function r(t,e,n){t.addEventListener(e,(function(t){t.preventDefault(),n(t)}))}function a(){return parseInt((new Date).valueOf()/1e3,10)}function i(t,e,n){var r=":children"==e?t.children:t.querySelectorAll(e);if(!n)return[].slice.call(r,0);for(var a=[],i=0;i<r.length;i++)a.push(n(r[i],i));return a}var o=86400,u=3600,s=(new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.inputNames=["d","h","m","s"],this.tracked={}}var s,l,c;return s=t,(l=[{key:"attach",value:function(t){var e=this;return this.baseUrl=t.action.replace(/\/+$/,""),this.formEl=t,this.alarmPlayer=i(this.formEl,".alarm-player")[0],this.inputNames.forEach((function(n){i(t,'[name="'+n+'"]',(function(t){e._renderInput(t,t.value),t.addEventListener("blur",(function(n){return e._onBlur(t,n)})),t.addEventListener("keydown",(function(n){return e._onKeydown(t,n)}))}))})),this.alarmPlayer.volume=.4,this._renderAlarmLink(),this._startOrStop({}),r(this.formEl,"submit",(function(){return e.start()})),window.addEventListener("popstate",(function(t){return e._startOrStop(t)})),this}},{key:"alarmActive",value:function(){return"off"!=localStorage.getItem("timer_alarm")}},{key:"inputsToSeconds",value:function(){var t=this.formEl;return parseInt(t.d.value.replace(/^0+/,"")||0,10)*o+parseInt(t.h.value.replace(/^0+/,"")||0,10)*u+60*parseInt(t.m.value.replace(/^0+/,"")||0,10)+parseInt(t.s.value.replace(/^0+/,"")||0,10)}},{key:"start",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a();(t=parseInt(t,10)||this.inputsToSeconds())&&(history.pushState({},document.title,[this.baseUrl,e,t].join("/")),window.scrollTo(0,0),setTimeout((function(){return i(document,'[href="#stop"]',(function(t){return t.focus()}))}),100)),this._startOrStop({})}},{key:"stop",value:function(){var t=this;this.tid&&clearInterval(this.tid),location.href.match(/\/(\d+)\/(\d+)/)&&history.pushState({},document.title,this.baseUrl),this._state("edit"),this.inputNames.forEach((function(e){return t._renderInput(t.formEl[e],localStorage.getItem("timer_"+e)||"0")})),location.href.match(/\#about/)||this.formEl.m.focus()}},{key:"toggleAlarm",value:function(){localStorage.setItem("timer_alarm",this.alarmActive()?"off":"on"),this._renderAlarmLink()}},{key:"_onBlur",value:function(t,e){t.value.length||this._renderInput(t,"0"),localStorage.setItem("timer_"+t.name,t.value)}},{key:"_onKeydown",value:function(t,e){if(!t.disabled&&!(e.altKey||e.ctrlKey||e.metaKey)){if(13==e.keyCode)return[e.preventDefault(),this.start()];var n=(e.keyCode||e.which)-48;if(!(n<0||n>9)){e.preventDefault();var r=t.getAttribute("max"),a=t.value.length>=r.length?n:parseInt(t.value+""+n,10);this._renderInput(t,a>r?r:a<0?0:a)}}}},{key:"_renderAlarmLink",value:function(){var t=this.alarmActive()?"Disable":"Enable";i(this.formEl,'[href="#alarm"]',(function(e){return e.textContent=t}))}},{key:"_renderCountdown",value:function(){var t=this,e=this.formEl,n=[0,0,0,this.ends-a()],r=[];if(n[3]<=0)return this.tid&&clearInterval(this.tid),setTimeout((function(){return t.alarmPlayer.pause()}),4e3),this.alarmActive()&&this.alarmPlayer.play(),this.inputNames.forEach((function(n){return t._renderInput(e[n],"0")})),void this._state("expired");n[0]=parseInt(n[3]/o,10),n[3]-=n[0]*o,n[1]=parseInt(n[3]/u,10),n[3]-=n[1]*u,n[2]=parseInt(n[3]/60,10),n[3]-=60*n[2];for(var i=0;i<n.length;i++)(n[i]||r.length)&&r.push(n[i]+this.inputNames[i]);document.title=r.join(" "),this._renderInput(e.d,n[0]),this._renderInput(e.h,n[1]),this._renderInput(e.m,n[2]),this._renderInput(e.s,n[3])}},{key:"_renderInput",value:function(t,e){e=String(e),t.closest("[data-shadow]").dataset.shadow=e.padStart("d"==t.name?3:2,"0"),t.value=e}},{key:"_startOrStop",value:function(){var t=this;this.tid&&clearInterval(this.tid);var n=e(location.href.match(/\/(\d+)\/(\d+)/)||[],3),r=(n[0],n[1]),i=n[2];return this.seconds=parseInt(i,10),this.ends=parseInt(r,10)+this.seconds,this.ends?this.ends-a()<=0?this._state("expired"):(this._state("countdown"),this._renderCountdown(),void(this.tid=setInterval((function(){return t._renderCountdown()}),1e3))):this.stop()}},{key:"_state",value:function(t){"edit"==t&&i(document,'[property="og:title"]',(function(t){return document.title=t.content})),"expired"==t&&i(document,".expired-text",(function(t){return document.title=t.textContent})),this.formEl.className=this.formEl.className.replace(/\s-\w+/," -"+t),i(this.formEl,"input",(function(e){return e.disabled="countdown"==t})),i(this.formEl,".countdown-footer",(function(t){return t.classList.add("hide")})),i(this.formEl,".countdown-footer.for-"+t,(function(t){return t.classList.remove("hide")}))}}])&&n(s.prototype,l),c&&n(s,c),t}())).attach(document.querySelector("form"));i(document,'a[href$="#alarm"]',(function(t){return r(t,"click",(function(t){return s.toggleAlarm(t)}))})),i(document,'a[href^="#start:"]',(function(t){return r(t,"click",(function(){return s.start(t.href.split("#start:")[1])}))})),i(document,'a[href^="#stop"]',(function(t){return r(t,"click",(function(){return s.stop()}))}))})();